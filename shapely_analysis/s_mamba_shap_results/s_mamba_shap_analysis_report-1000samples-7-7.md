# SHAP分析报告 - s_mamba

## 📊 分析概述

- **模型名称**: s_mamba
- **模型路径**: /mnt/raid/zhengsen/pths/7to1_focal_withRegressionLoss_withfirms_baseline/s_mamba_best_recall.pth
- **输入序列长度**: 7
- **预测长度**: 1
- **输入通道数**: 39
- **样本数量**: 1000
- **分析时间**: 2025-07-31 22:32:42

## 🔍 SHAP值统计信息

### 整体统计
- **平均SHAP值**: 0.000372
- **SHAP值标准差**: 0.004643
- **SHAP值范围**: [-0.009009, 0.305324]
- **正向影响比例**: 59.74%
- **负向影响比例**: 40.10%

## 🏆 特征重要性排名 (Top 20)

| 排名 | 特征名称 | 平均绝对SHAP值 | 正向/负向影响 | 影响方向 (正样本比例/负样本比例) |
|------|----------|----------------|---------------|----------------------------------|
| 1 | Firms_Fire | 0.014264 | 0.014261/0.000003 | 🟢 正向 (99.9%/0.1%) |
| 2 | Temperatu | 0.000584 | 0.000435/0.000150 | 🟢 正向 (70.5%/29.5%) |
| 3 | U_Wind_10m | 0.000073 | 0.000009/0.000064 | 🔴 负向 (21.4%/78.6%) |
| 4 | V_Wind_10m | 0.000047 | 0.000006/0.000041 | 🔴 负向 (25.4%/74.6%) |
| 5 | Snow_Cover | 0.000032 | 0.000007/0.000025 | 🔴 负向 (29.4%/70.5%) |
| 6 | Total_Percipitation | 0.000021 | 0.000006/0.000015 | 🔴 负向 (36.2%/63.8%) |
| 7 | Surface_Latent_heat | 0.000015 | 0.000006/0.000009 | 🔴 负向 (39.9%/60.0%) |
| 8 | Downpoint | 0.000013 | 0.000006/0.000006 | 🔴 负向 (48.3%/51.5%) |
| 9 | Surface_Pressure | 0.000010 | 0.000006/0.000004 | 🟢 正向 (53.0%/46.9%) |
| 10 | Volumetric_soil_moisture1 | 0.000009 | 0.000006/0.000003 | 🟢 正向 (57.1%/42.7%) |
| 11 | Volumetric_soil_moisture2 | 0.000008 | 0.000006/0.000002 | 🟢 正向 (60.7%/39.2%) |
| 12 | Volumetric_soil_moisture3 | 0.000007 | 0.000005/0.000002 | 🟢 正向 (61.7%/38.1%) |
| 13 | Volumetric_soil_moisture4 | 0.000007 | 0.000005/0.000002 | 🟢 正向 (64.3%/35.5%) |
| 14 | Aspect | 0.000006 | 0.000005/0.000001 | 🟢 正向 (64.6%/35.3%) |
| 15 | DEM | 0.000006 | 0.000005/0.000001 | 🟢 正向 (65.7%/34.1%) |
| 16 | Hillshade | 0.000006 | 0.000005/0.000001 | 🟢 正向 (66.1%/33.8%) |
| 17 | Slope | 0.000006 | 0.000005/0.000001 | 🟢 正向 (65.8%/34.0%) |
| 18 | D2Infrastre | 0.000006 | 0.000004/0.000001 | 🟢 正向 (66.1%/33.7%) |
| 19 | D2Water | 0.000005 | 0.000004/0.000001 | 🟢 正向 (66.0%/33.8%) |
| 20 | LULC | 0.000005 | 0.000004/0.000001 | 🟢 正向 (65.2%/34.7%) |

## 📈 详细特征分析

### 最重要的特征分析

#### 1. Firms_Fire

- **重要性排名**: 第1位
- **平均绝对SHAP值**: 0.014264
- **正向影响强度**: 0.014261 (占99.9%样本)
- **负向影响强度**: 0.000003 (占0.1%样本)
- **综合影响方向**: 正向
- **高值样本平均SHAP**: 0.016590
- **低值样本平均SHAP**: 0.011927
- **特征值范围**: [0.0132, 0.9739]

**分析解读**: 
Firms_Fire对模型预测有正向影响。当Firms_Fire值较高时，模型倾向于增加预测值。 特征值的高低对SHAP值影响较小。

#### 2. Temperatu

- **重要性排名**: 第2位
- **平均绝对SHAP值**: 0.000584
- **正向影响强度**: 0.000435 (占70.5%样本)
- **负向影响强度**: 0.000150 (占29.5%样本)
- **综合影响方向**: 正向
- **高值样本平均SHAP**: 0.000399
- **低值样本平均SHAP**: 0.000170
- **特征值范围**: [0.0233, 0.9692]

**分析解读**: 
Temperatu对模型预测有正向影响。当Temperatu值较高时，模型倾向于增加预测值。 特征值的高低对SHAP值影响较小。

#### 3. U_Wind_10m

- **重要性排名**: 第3位
- **平均绝对SHAP值**: 0.000073
- **正向影响强度**: 0.000009 (占21.4%样本)
- **负向影响强度**: 0.000064 (占78.6%样本)
- **综合影响方向**: 负向
- **高值样本平均SHAP**: -0.000017
- **低值样本平均SHAP**: -0.000093
- **特征值范围**: [0.0317, 0.9778]

**分析解读**: 
U_Wind_10m对模型预测有负向影响。当U_Wind_10m值较高时，模型倾向于减少预测值。 特征值的高低对SHAP值影响较小。

#### 4. V_Wind_10m

- **重要性排名**: 第4位
- **平均绝对SHAP值**: 0.000047
- **正向影响强度**: 0.000006 (占25.4%样本)
- **负向影响强度**: 0.000041 (占74.6%样本)
- **综合影响方向**: 负向
- **高值样本平均SHAP**: -0.000005
- **低值样本平均SHAP**: -0.000064
- **特征值范围**: [0.0284, 0.9861]

**分析解读**: 
V_Wind_10m对模型预测有负向影响。当V_Wind_10m值较高时，模型倾向于减少预测值。 特征值的高低对SHAP值影响较小。

#### 5. Snow_Cover

- **重要性排名**: 第5位
- **平均绝对SHAP值**: 0.000032
- **正向影响强度**: 0.000007 (占29.4%样本)
- **负向影响强度**: 0.000025 (占70.5%样本)
- **综合影响方向**: 负向
- **高值样本平均SHAP**: 0.000005
- **低值样本平均SHAP**: -0.000041
- **特征值范围**: [0.0225, 0.9734]

**分析解读**: 
Snow_Cover对模型预测有负向影响。当Snow_Cover值较高时，模型倾向于减少预测值。 特征值的高低对SHAP值影响较小。

## 🗂️ 按类别分析特征

### 气象数据特征
- **Temperatu**: 排名第2位，重要性0.000584，正向0.000435(70.5%)，负向0.000150(29.5%)
- **V_Wind_10m**: 排名第4位，重要性0.000047，正向0.000006(25.4%)，负向0.000041(74.6%)
- **Downpoint**: 排名第8位，重要性0.000013，正向0.000006(48.3%)，负向0.000006(51.5%)

### 土壤数据特征

### 地形数据特征
- **Aspect**: 排名第14位，重要性0.000006，正向0.000005(64.6%)，负向0.000001(35.3%)
- **DEM**: 排名第15位，重要性0.000006，正向0.000005(65.7%)，负向0.000001(34.1%)
- **Hillshade**: 排名第16位，重要性0.000006，正向0.000005(66.1%)，负向0.000001(33.8%)
- **Slope**: 排名第17位，重要性0.000006，正向0.000005(65.8%)，负向0.000001(34.0%)
- **D2Infrastre**: 排名第18位，重要性0.000006，正向0.000004(66.1%)，负向0.000001(33.7%)
- **D2Water**: 排名第19位，重要性0.000005，正向0.000004(66.0%)，负向0.000001(33.8%)

### 卫星数据特征
- **NDVI**: 排名第21位，重要性0.000005，正向0.000004(66.2%)，负向0.000001(33.6%)
- **EVI**: 排名第22位，重要性0.000005，正向0.000004(66.0%)，负向0.000001(33.8%)
- **Band1**: 排名第23位，重要性0.000005，正向0.000004(64.4%)，负向0.000001(35.6%)
- **Band2**: 排名第24位，重要性0.000004，正向0.000004(65.4%)，负向0.000001(34.5%)
- **Band3**: 排名第26位，重要性0.000004，正向0.000003(64.6%)，负向0.000001(35.2%)
- **Band7**: 排名第25位，重要性0.000004，正向0.000004(64.1%)，负向0.000001(35.7%)
- **LST_N**: 排名第33位，重要性0.000004，正向0.000003(61.6%)，负向0.000001(38.2%)
- **LAI**: 排名第39位，重要性0.000003，正向0.000003(62.1%)，负向0.000001(37.6%)

## 📊 预测结果分析

### 预测值统计
- **平均预测值**: 0.874126
- **预测值标准差**: 0.125698
- **预测值范围**: [-0.179527, 1.536482]

### 预测分布
- **高预测值样本比例**: 1950.00%
- **低预测值样本比例**: 1950.00%

## 🎯 关键发现

### 1. 最重要的驱动因素
根据SHAP分析，以下特征对模型预测影响最大：
- **Firms_Fire**: 0.014264
- **Temperatu**: 0.000584
- **U_Wind_10m**: 0.000073

### 2. 影响方向分析
- **正向影响特征**: 这些特征值越高，模型预测值越大
- **负向影响特征**: 这些特征值越高，模型预测值越小

### 3. 特征交互模式
通过SHAP值分布可以看出不同特征之间的交互关系：
- 某些特征组合可能产生协同效应
- 不同特征值范围对预测的影响程度不同

## 💡 建议与改进

### 1. 数据收集建议
- 重点关注高重要性特征的测量精度
- 考虑增加对重要特征的时间分辨率
- 优化数据预处理流程

### 2. 模型优化建议
- 可以针对高重要性特征进行特征工程
- 考虑使用特征选择方法减少噪声特征
- 优化模型架构以更好地利用重要特征

### 3. 应用建议
- 在实际应用中优先关注高重要性特征
- 建立基于SHAP值的异常检测机制
- 定期更新SHAP分析以监控模型性能变化

## 📋 技术说明

### SHAP值计算原理
本分析使用基于扰动的SHAP值计算方法：
1. 使用背景样本建立基线预测
2. 对每个特征进行扰动（用背景平均值替换）
3. 计算预测差异作为SHAP值
4. 统计所有样本的SHAP值分布

### 正负影响计算方法
为了避免正负影响抵消的问题，本分析采用以下方法：
1. **正向影响**: 计算所有正SHAP值的平均值，表示该特征对预测的正向贡献强度
2. **负向影响**: 计算所有负SHAP值的平均值的绝对值，表示该特征对预测的负向贡献强度
3. **正负样本比例**: 统计正负SHAP值在总样本中的占比
4. **综合影响方向**: 正向影响 - 负向影响，正值表示整体正向，负值表示整体负向

### 可视化说明
- **SHAP摘要图**: 显示每个特征的SHAP值分布和特征值关系
- **特征重要性图**: 按重要性排序显示各特征的平均绝对SHAP值
- **颜色编码**: 蓝色表示低特征值，红色表示高特征值

---
*报告生成时间: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}*
