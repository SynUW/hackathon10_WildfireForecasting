# SHAP分析报告 - s_mamba

## 📊 分析概述

- **模型名称**: s_mamba
- **模型路径**: /mnt/raid/zhengsen/pths/365to1_focal_withRegressionLoss_withfirms_baseline/s_mamba_best_recall.pth
- **输入序列长度**: 365
- **预测长度**: 1
- **输入通道数**: 39
- **样本数量**: 100
- **分析时间**: 2025-07-31 22:31:02

## 🔍 SHAP值统计信息

### 整体统计
- **平均SHAP值**: 0.000002
- **SHAP值标准差**: 0.000422
- **SHAP值范围**: [-0.018745, 0.098396]
- **正向影响比例**: 49.83%
- **负向影响比例**: 50.01%

## 🏆 特征重要性排名 (Top 20)

| 排名 | 特征名称 | 平均绝对SHAP值 | 正向/负向影响 | 影响方向 (正样本比例/负样本比例) |
|------|----------|----------------|---------------|----------------------------------|
| 1 | Firms_Fire | 0.001040 | 0.000554/0.000486 | 🟢 正向 (47.8%/52.2%) |
| 2 | Temperatu | 0.000318 | 0.000164/0.000154 | 🟢 正向 (51.8%/48.2%) |
| 3 | U_Wind_10m | 0.000042 | 0.000021/0.000021 | 🟢 正向 (48.5%/51.4%) |
| 4 | V_Wind_10m | 0.000034 | 0.000017/0.000016 | 🟢 正向 (48.9%/51.0%) |
| 5 | Snow_Cover | 0.000026 | 0.000013/0.000013 | 🟢 正向 (49.1%/50.8%) |
| 6 | Band20_N | 0.000022 | 0.000011/0.000011 | 🔴 负向 (50.2%/49.6%) |
| 7 | Band2 | 0.000022 | 0.000011/0.000011 | 🔴 负向 (50.1%/49.8%) |
| 8 | Total_Percipitation | 0.000021 | 0.000011/0.000011 | 🟢 正向 (49.0%/50.8%) |
| 9 | Band21_D | 0.000021 | 0.000010/0.000011 | 🔴 负向 (50.2%/49.6%) |
| 10 | Band3 | 0.000021 | 0.000010/0.000011 | 🔴 负向 (50.2%/49.6%) |
| 11 | Band29_N | 0.000021 | 0.000010/0.000011 | 🔴 负向 (50.5%/49.3%) |
| 12 | Band21_N | 0.000021 | 0.000010/0.000011 | 🔴 负向 (50.3%/49.5%) |
| 13 | Band20_D | 0.000021 | 0.000010/0.000011 | 🔴 负向 (50.0%/49.8%) |
| 14 | LST_N | 0.000021 | 0.000010/0.000011 | 🔴 负向 (50.1%/49.7%) |
| 15 | Band31_N | 0.000021 | 0.000010/0.000010 | 🔴 负向 (50.1%/49.7%) |
| 16 | Band32_N | 0.000020 | 0.000010/0.000011 | 🔴 负向 (50.0%/49.8%) |
| 17 | Band7 | 0.000020 | 0.000010/0.000010 | 🔴 负向 (50.0%/49.9%) |
| 18 | Band32_D | 0.000020 | 0.000010/0.000010 | 🔴 负向 (50.3%/49.5%) |
| 19 | Band29_D | 0.000020 | 0.000010/0.000010 | 🔴 负向 (50.2%/49.6%) |
| 20 | LST_Day | 0.000020 | 0.000010/0.000010 | 🔴 负向 (50.1%/49.8%) |

## 📈 详细特征分析

### 最重要的特征分析

#### 1. Firms_Fire

- **重要性排名**: 第1位
- **平均绝对SHAP值**: 0.001040
- **正向影响强度**: 0.000554 (占47.8%样本)
- **负向影响强度**: 0.000486 (占52.2%样本)
- **综合影响方向**: 正向
- **高值样本平均SHAP**: 0.000127
- **低值样本平均SHAP**: 0.000009
- **特征值范围**: [0.0175, 0.9854]

**分析解读**: 
Firms_Fire对模型预测有正向影响。当Firms_Fire值较高时，模型倾向于增加预测值。 特征值的高低对SHAP值影响较小。

#### 2. Temperatu

- **重要性排名**: 第2位
- **平均绝对SHAP值**: 0.000318
- **正向影响强度**: 0.000164 (占51.8%样本)
- **负向影响强度**: 0.000154 (占48.2%样本)
- **综合影响方向**: 正向
- **高值样本平均SHAP**: 0.000013
- **低值样本平均SHAP**: 0.000008
- **特征值范围**: [0.0111, 0.9866]

**分析解读**: 
Temperatu对模型预测有正向影响。当Temperatu值较高时，模型倾向于增加预测值。 特征值的高低对SHAP值影响较小。

#### 3. U_Wind_10m

- **重要性排名**: 第3位
- **平均绝对SHAP值**: 0.000042
- **正向影响强度**: 0.000021 (占48.5%样本)
- **负向影响强度**: 0.000021 (占51.4%样本)
- **综合影响方向**: 正向
- **高值样本平均SHAP**: 0.000000
- **低值样本平均SHAP**: 0.000000
- **特征值范围**: [0.0175, 0.9821]

**分析解读**: 
U_Wind_10m对模型预测有正向影响。当U_Wind_10m值较高时，模型倾向于增加预测值。 特征值的高低对SHAP值影响较小。

#### 4. V_Wind_10m

- **重要性排名**: 第4位
- **平均绝对SHAP值**: 0.000034
- **正向影响强度**: 0.000017 (占48.9%样本)
- **负向影响强度**: 0.000016 (占51.0%样本)
- **综合影响方向**: 正向
- **高值样本平均SHAP**: 0.000001
- **低值样本平均SHAP**: 0.000001
- **特征值范围**: [0.0144, 0.9948]

**分析解读**: 
V_Wind_10m对模型预测有正向影响。当V_Wind_10m值较高时，模型倾向于增加预测值。 特征值的高低对SHAP值影响较小。

#### 5. Snow_Cover

- **重要性排名**: 第5位
- **平均绝对SHAP值**: 0.000026
- **正向影响强度**: 0.000013 (占49.1%样本)
- **负向影响强度**: 0.000013 (占50.8%样本)
- **综合影响方向**: 正向
- **高值样本平均SHAP**: -0.000000
- **低值样本平均SHAP**: 0.000001
- **特征值范围**: [0.0225, 0.9852]

**分析解读**: 
Snow_Cover对模型预测有正向影响。当Snow_Cover值较高时，模型倾向于增加预测值。 特征值的高低对SHAP值影响较小。

## 🗂️ 按类别分析特征

### 气象数据特征
- **Temperatu**: 排名第2位，重要性0.000318，正向0.000164(51.8%)，负向0.000154(48.2%)
- **V_Wind_10m**: 排名第4位，重要性0.000034，正向0.000017(48.9%)，负向0.000016(51.0%)
- **Downpoint**: 排名第33位，重要性0.000015，正向0.000008(49.1%)，负向0.000007(50.7%)

### 土壤数据特征

### 地形数据特征
- **Aspect**: 排名第34位，重要性0.000015，正向0.000007(49.6%)，负向0.000008(50.3%)
- **DEM**: 排名第31位，重要性0.000016，正向0.000008(49.9%)，负向0.000008(49.9%)
- **Hillshade**: 排名第30位，重要性0.000016，正向0.000008(49.6%)，负向0.000008(50.2%)
- **Slope**: 排名第29位，重要性0.000016，正向0.000008(49.9%)，负向0.000008(49.9%)
- **D2Infrastre**: 排名第27位，重要性0.000018，正向0.000009(50.1%)，负向0.000009(49.7%)
- **D2Water**: 排名第24位，重要性0.000019，正向0.000009(49.7%)，负向0.000010(50.1%)

### 卫星数据特征
- **NDVI**: 排名第25位，重要性0.000018，正向0.000009(49.9%)，负向0.000009(50.0%)
- **EVI**: 排名第26位，重要性0.000018，正向0.000009(50.0%)，负向0.000009(49.8%)
- **Band1**: 排名第23位，重要性0.000020，正向0.000009(50.1%)，负向0.000010(49.7%)
- **Band2**: 排名第7位，重要性0.000022，正向0.000011(50.1%)，负向0.000011(49.8%)
- **Band3**: 排名第10位，重要性0.000021，正向0.000010(50.2%)，负向0.000011(49.6%)
- **Band7**: 排名第17位，重要性0.000020，正向0.000010(50.0%)，负向0.000010(49.9%)
- **LST_N**: 排名第14位，重要性0.000021，正向0.000010(50.1%)，负向0.000011(49.7%)
- **LAI**: 排名第32位，重要性0.000016，正向0.000008(50.5%)，负向0.000008(49.3%)

## 📊 预测结果分析

### 预测值统计
- **平均预测值**: 1.658974
- **预测值标准差**: 0.137270
- **预测值范围**: [1.163607, 2.106198]

### 预测分布
- **高预测值样本比例**: 1950.00%
- **低预测值样本比例**: 1950.00%

## 🎯 关键发现

### 1. 最重要的驱动因素
根据SHAP分析，以下特征对模型预测影响最大：
- **Firms_Fire**: 0.001040
- **Temperatu**: 0.000318
- **U_Wind_10m**: 0.000042

### 2. 影响方向分析
- **正向影响特征**: 这些特征值越高，模型预测值越大
- **负向影响特征**: 这些特征值越高，模型预测值越小

### 3. 特征交互模式
通过SHAP值分布可以看出不同特征之间的交互关系：
- 某些特征组合可能产生协同效应
- 不同特征值范围对预测的影响程度不同

## 💡 建议与改进

### 1. 数据收集建议
- 重点关注高重要性特征的测量精度
- 考虑增加对重要特征的时间分辨率
- 优化数据预处理流程

### 2. 模型优化建议
- 可以针对高重要性特征进行特征工程
- 考虑使用特征选择方法减少噪声特征
- 优化模型架构以更好地利用重要特征

### 3. 应用建议
- 在实际应用中优先关注高重要性特征
- 建立基于SHAP值的异常检测机制
- 定期更新SHAP分析以监控模型性能变化

## 📋 技术说明

### SHAP值计算原理
本分析使用基于扰动的SHAP值计算方法：
1. 使用背景样本建立基线预测
2. 对每个特征进行扰动（用背景平均值替换）
3. 计算预测差异作为SHAP值
4. 统计所有样本的SHAP值分布

### 正负影响计算方法
为了避免正负影响抵消的问题，本分析采用以下方法：
1. **正向影响**: 计算所有正SHAP值的平均值，表示该特征对预测的正向贡献强度
2. **负向影响**: 计算所有负SHAP值的平均值的绝对值，表示该特征对预测的负向贡献强度
3. **正负样本比例**: 统计正负SHAP值在总样本中的占比
4. **综合影响方向**: 正向影响 - 负向影响，正值表示整体正向，负值表示整体负向

### 可视化说明
- **SHAP摘要图**: 显示每个特征的SHAP值分布和特征值关系
- **特征重要性图**: 按重要性排序显示各特征的平均绝对SHAP值
- **颜色编码**: 蓝色表示低特征值，红色表示高特征值

---
*报告生成时间: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}*
