# SHAP分析报告 - s_mamba

## 📊 分析概述

- **模型名称**: s_mamba
- **模型路径**: /mnt/raid/zhengsen/pths/7to1_focal_withRegressionLoss_withfirms_baseline/s_mamba_best_recall.pth
- **输入序列长度**: 7
- **预测长度**: 1
- **输入通道数**: 39
- **样本数量**: 100
- **分析时间**: 2025-07-31 21:45:20

## 🔍 SHAP值统计信息

### 整体统计
- **平均SHAP值**: -0.000149
- **SHAP值标准差**: 0.057348
- **SHAP值范围**: [-0.358522, 0.368317]
- **正向影响比例**: 50.15%
- **负向影响比例**: 49.85%

## 🏆 特征重要性排名 (Top 20)

| 排名 | 特征名称 | 平均绝对SHAP值 | 正向/负向影响 | 影响方向 (正样本比例/负样本比例) |
|------|----------|----------------|---------------|----------------------------------|
| 1 | Volumetric_soil_moisture2 | 0.041664 | 0.021115/0.020549 | 🟢 正向 (48.7%/51.3%) |
| 2 | Volumetric_soil_moisture4 | 0.040836 | 0.020923/0.019913 | 🟢 正向 (48.7%/51.3%) |
| 3 | DEM | 0.040440 | 0.019458/0.020982 | 🔴 负向 (49.1%/50.9%) |
| 4 | LST_Day | 0.040369 | 0.021796/0.018573 | 🟢 正向 (53.6%/46.4%) |
| 5 | Band32_N | 0.040368 | 0.019198/0.021170 | 🔴 负向 (49.4%/50.6%) |
| 6 | LAI | 0.040107 | 0.019856/0.020251 | 🔴 负向 (51.9%/48.1%) |
| 7 | Band21_N | 0.039974 | 0.019805/0.020169 | 🔴 负向 (49.3%/50.7%) |
| 8 | V_Wind_10m | 0.039961 | 0.020533/0.019427 | 🟢 正向 (50.1%/49.9%) |
| 9 | Surface_Pressure | 0.039638 | 0.019887/0.019752 | 🟢 正向 (49.9%/50.1%) |
| 10 | EVI | 0.039604 | 0.019045/0.020559 | 🔴 负向 (50.9%/49.1%) |
| 11 | Band20_D | 0.039590 | 0.018946/0.020645 | 🔴 负向 (49.6%/50.4%) |
| 12 | Aspect | 0.039523 | 0.018852/0.020671 | 🔴 负向 (48.7%/51.3%) |
| 13 | NDVI | 0.039411 | 0.019239/0.020172 | 🔴 负向 (48.4%/51.6%) |
| 14 | Total_Percipitation | 0.039269 | 0.019185/0.020084 | 🔴 负向 (50.3%/49.7%) |
| 15 | LULC | 0.039211 | 0.019073/0.020138 | 🔴 负向 (48.9%/51.1%) |
| 16 | Hillshade | 0.039200 | 0.021187/0.018013 | 🟢 正向 (53.1%/46.9%) |
| 17 | Temperatu | 0.039026 | 0.017961/0.021064 | 🔴 负向 (48.4%/51.6%) |
| 18 | Band2 | 0.038910 | 0.019734/0.019176 | 🟢 正向 (49.9%/50.1%) |
| 19 | Slope | 0.038853 | 0.019394/0.019459 | 🔴 负向 (49.4%/50.6%) |
| 20 | Band31_N | 0.038850 | 0.018993/0.019857 | 🔴 负向 (49.7%/50.3%) |

## 📈 详细特征分析

### 最重要的特征分析

#### 1. Volumetric_soil_moisture2

- **重要性排名**: 第1位
- **平均绝对SHAP值**: 0.041664
- **正向影响强度**: 0.021115 (占48.7%样本)
- **负向影响强度**: 0.020549 (占51.3%样本)
- **综合影响方向**: 正向
- **高值样本平均SHAP**: 0.006292
- **低值样本平均SHAP**: -0.005160
- **特征值范围**: [0.0224, 0.9419]

**分析解读**: 
Volumetric_soil_moisture2对模型预测有正向影响。当Volumetric_soil_moisture2值较高时，模型倾向于增加预测值。 特征值的高低对SHAP值有显著影响。

#### 2. Volumetric_soil_moisture4

- **重要性排名**: 第2位
- **平均绝对SHAP值**: 0.040836
- **正向影响强度**: 0.020923 (占48.7%样本)
- **负向影响强度**: 0.019913 (占51.3%样本)
- **综合影响方向**: 正向
- **高值样本平均SHAP**: 0.005207
- **低值样本平均SHAP**: -0.003186
- **特征值范围**: [0.0433, 0.9681]

**分析解读**: 
Volumetric_soil_moisture4对模型预测有正向影响。当Volumetric_soil_moisture4值较高时，模型倾向于增加预测值。 特征值的高低对SHAP值影响较小。

#### 3. DEM

- **重要性排名**: 第3位
- **平均绝对SHAP值**: 0.040440
- **正向影响强度**: 0.019458 (占49.1%样本)
- **负向影响强度**: 0.020982 (占50.9%样本)
- **综合影响方向**: 负向
- **高值样本平均SHAP**: 0.003972
- **低值样本平均SHAP**: -0.007019
- **特征值范围**: [0.0492, 0.9574]

**分析解读**: 
DEM对模型预测有负向影响。当DEM值较高时，模型倾向于减少预测值。 特征值的高低对SHAP值有显著影响。

#### 4. LST_Day

- **重要性排名**: 第4位
- **平均绝对SHAP值**: 0.040369
- **正向影响强度**: 0.021796 (占53.6%样本)
- **负向影响强度**: 0.018573 (占46.4%样本)
- **综合影响方向**: 正向
- **高值样本平均SHAP**: 0.008842
- **低值样本平均SHAP**: -0.002396
- **特征值范围**: [0.0388, 0.9767]

**分析解读**: 
LST_Day对模型预测有正向影响。当LST_Day值较高时，模型倾向于增加预测值。 特征值的高低对SHAP值有显著影响。

#### 5. Band32_N

- **重要性排名**: 第5位
- **平均绝对SHAP值**: 0.040368
- **正向影响强度**: 0.019198 (占49.4%样本)
- **负向影响强度**: 0.021170 (占50.6%样本)
- **综合影响方向**: 负向
- **高值样本平均SHAP**: 0.007438
- **低值样本平均SHAP**: -0.011382
- **特征值范围**: [0.0500, 0.9629]

**分析解读**: 
Band32_N对模型预测有负向影响。当Band32_N值较高时，模型倾向于减少预测值。 特征值的高低对SHAP值有显著影响。

## 🗂️ 按类别分析特征

### 气象数据特征
- **Temperatu**: 排名第17位，重要性0.039026，正向0.017961(48.4%)，负向0.021064(51.6%)
- **V_Wind_10m**: 排名第8位，重要性0.039961，正向0.020533(50.1%)，负向0.019427(49.9%)
- **Downpoint**: 排名第26位，重要性0.038519，正向0.019341(48.7%)，负向0.019178(51.3%)

### 土壤数据特征

### 地形数据特征
- **Aspect**: 排名第12位，重要性0.039523，正向0.018852(48.7%)，负向0.020671(51.3%)
- **DEM**: 排名第3位，重要性0.040440，正向0.019458(49.1%)，负向0.020982(50.9%)
- **Hillshade**: 排名第16位，重要性0.039200，正向0.021187(53.1%)，负向0.018013(46.9%)
- **Slope**: 排名第19位，重要性0.038853，正向0.019394(49.4%)，负向0.019459(50.6%)
- **D2Infrastre**: 排名第27位，重要性0.038507，正向0.019213(49.9%)，负向0.019293(50.1%)
- **D2Water**: 排名第22位，重要性0.038642，正向0.017477(47.1%)，负向0.021166(52.9%)

### 卫星数据特征
- **NDVI**: 排名第13位，重要性0.039411，正向0.019239(48.4%)，负向0.020172(51.6%)
- **EVI**: 排名第10位，重要性0.039604，正向0.019045(50.9%)，负向0.020559(49.1%)
- **Band1**: 排名第24位，重要性0.038614，正向0.019580(49.9%)，负向0.019035(50.1%)
- **Band2**: 排名第18位，重要性0.038910，正向0.019734(49.9%)，负向0.019176(50.1%)
- **Band3**: 排名第36位，重要性0.037801，正向0.018908(49.4%)，负向0.018893(50.6%)
- **Band7**: 排名第23位，重要性0.038639，正向0.021099(52.0%)，负向0.017540(48.0%)
- **LST_N**: 排名第33位，重要性0.037992，正向0.021089(56.4%)，负向0.016902(43.6%)
- **LAI**: 排名第6位，重要性0.040107，正向0.019856(51.9%)，负向0.020251(48.1%)

## 📊 预测结果分析

### 预测值统计
- **平均预测值**: 0.873444
- **预测值标准差**: 0.126316
- **预测值范围**: [0.171692, 1.431018]

### 预测分布
- **高预测值样本比例**: 1950.00%
- **低预测值样本比例**: 1950.00%

## 🎯 关键发现

### 1. 最重要的驱动因素
根据SHAP分析，以下特征对模型预测影响最大：
- **Volumetric_soil_moisture2**: 0.041664
- **Volumetric_soil_moisture4**: 0.040836
- **DEM**: 0.040440

### 2. 影响方向分析
- **正向影响特征**: 这些特征值越高，模型预测值越大
- **负向影响特征**: 这些特征值越高，模型预测值越小

### 3. 特征交互模式
通过SHAP值分布可以看出不同特征之间的交互关系：
- 某些特征组合可能产生协同效应
- 不同特征值范围对预测的影响程度不同

## 💡 建议与改进

### 1. 数据收集建议
- 重点关注高重要性特征的测量精度
- 考虑增加对重要特征的时间分辨率
- 优化数据预处理流程

### 2. 模型优化建议
- 可以针对高重要性特征进行特征工程
- 考虑使用特征选择方法减少噪声特征
- 优化模型架构以更好地利用重要特征

### 3. 应用建议
- 在实际应用中优先关注高重要性特征
- 建立基于SHAP值的异常检测机制
- 定期更新SHAP分析以监控模型性能变化

## 📋 技术说明

### SHAP值计算原理
本分析使用基于扰动的SHAP值计算方法：
1. 使用背景样本建立基线预测
2. 对每个特征进行扰动（用背景平均值替换）
3. 计算预测差异作为SHAP值
4. 统计所有样本的SHAP值分布

### 正负影响计算方法
为了避免正负影响抵消的问题，本分析采用以下方法：
1. **正向影响**: 计算所有正SHAP值的平均值，表示该特征对预测的正向贡献强度
2. **负向影响**: 计算所有负SHAP值的平均值的绝对值，表示该特征对预测的负向贡献强度
3. **正负样本比例**: 统计正负SHAP值在总样本中的占比
4. **综合影响方向**: 正向影响 - 负向影响，正值表示整体正向，负值表示整体负向

### 可视化说明
- **SHAP摘要图**: 显示每个特征的SHAP值分布和特征值关系
- **特征重要性图**: 按重要性排序显示各特征的平均绝对SHAP值
- **颜色编码**: 蓝色表示低特征值，红色表示高特征值

---
*报告生成时间: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}*
